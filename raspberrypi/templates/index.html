<!-- templates/index.html -->
<!DOCTYPE html>
<html>

<head>
    <title>Advanced Face Recognition</title>
    <style>
        .container {
            display: flex;
        }

        .video-column {
            flex: 60%;
        }

        .control-column {
            flex: 40%;
            padding: 20px;
        }

        .face-info {
            margin-top: 20px;
        }

        .profile-list {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Face Recognition System</h1>

    <div class="container">
        <div class="video-column">
            <img src="{{ url_for('video_feed') }}" width="640" height="480">
        </div>

        <div class="control-column">
            <h2>Add New Profile</h2>
            <form id="profileForm" enctype="multipart/form-data">
                <input type="text" name="name" placeholder="Person's name" required>
                <input type="file" name="files[]" multiple accept="image/*" required>
                <button type="submit">Create Profile</button>
            </form>

            <div class="profile-list">
                <h3>Existing Profiles</h3>
                <ul>
                    {% for profile in profiles %}
                    <li>{{ profile }}</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="face-info">
                <h3>Detected Faces</h3>
                <table border="1">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Position (X,Y)</th>
                            <th>Distance (in)</th>
                        </tr>
                    </thead>
                    <tbody id="faceTable">
                        <!-- Filled by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Update face positions
        setInterval(async () => {
            const response = await fetch('/get_faces');
            const faces = await response.json();

            let tableHtml = '';
            faces.forEach(face => {
                tableHtml += `
                    <tr>
                        <td>${face.name}</td>
                        <td>(${face.position[0]}, ${face.position[1]})</td>
                        <td>${face.distance}</td>
                    </tr>
                `;
            });

            document.getElementById('faceTable').innerHTML = tableHtml ||
                '<tr><td colspan="3">No faces detected</td></tr>';
        }, 300);

        // Handle profile creation
        document.getElementById('profileForm').onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);

            const response = await fetch('/add_profile', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            if (result.success) {
                alert('Profile created successfully!');
                location.reload();
            } else {
                alert(result.error || 'Error creating profile');
            }
        };
    </script>
</body>

</html>